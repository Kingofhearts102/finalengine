(function(b){var d=b.Vector3DUtil;var a=b.CollOutBodyData;var h=b.JSegment;var c=b.JNumber3D;var f=b.RigidBody;var g=b.CollDetectInfo;var e=function(){this.collBody=[];this.detectionFunctors={};this.detectionFunctors["BOX_BOX"]=new b.CollDetectBoxBox();this.detectionFunctors["BOX_SPHERE"]=new b.CollDetectSphereBox();this.detectionFunctors["BOX_CAPSULE"]=new b.CollDetectCapsuleBox();this.detectionFunctors["BOX_PLANE"]=new b.CollDetectBoxPlane();this.detectionFunctors["BOX_TERRAIN"]=new b.CollDetectBoxTerrain();this.detectionFunctors["BOX_TRIANGLEMESH"]=new b.CollDetectBoxMesh();this.detectionFunctors["SPHERE_BOX"]=new b.CollDetectSphereBox();this.detectionFunctors["SPHERE_SPHERE"]=new b.CollDetectSphereSphere();this.detectionFunctors["SPHERE_CAPSULE"]=new b.CollDetectSphereCapsule();this.detectionFunctors["SPHERE_PLANE"]=new b.CollDetectSpherePlane();this.detectionFunctors["SPHERE_TERRAIN"]=new b.CollDetectSphereTerrain();this.detectionFunctors["SPHERE_TRIANGLEMESH"]=new b.CollDetectSphereMesh();this.detectionFunctors["CAPSULE_CAPSULE"]=new b.CollDetectCapsuleCapsule();this.detectionFunctors["CAPSULE_BOX"]=new b.CollDetectCapsuleBox();this.detectionFunctors["CAPSULE_SPHERE"]=new b.CollDetectSphereCapsule();this.detectionFunctors["CAPSULE_PLANE"]=new b.CollDetectCapsulePlane();this.detectionFunctors["CAPSULE_TERRAIN"]=new b.CollDetectCapsuleTerrain();this.detectionFunctors["PLANE_BOX"]=new b.CollDetectBoxPlane();this.detectionFunctors["PLANE_SPHERE"]=new b.CollDetectSpherePlane();this.detectionFunctors["PLANE_CAPSULE"]=new b.CollDetectCapsulePlane();this.detectionFunctors["TERRAIN_SPHERE"]=new b.CollDetectSphereTerrain();this.detectionFunctors["TERRAIN_BOX"]=new b.CollDetectBoxTerrain();this.detectionFunctors["TERRAIN_CAPSULE"]=new b.CollDetectCapsuleTerrain();this.detectionFunctors["TRIANGLEMESH_SPHERE"]=new b.CollDetectSphereMesh();this.detectionFunctors["TRIANGLEMESH_BOX"]=new b.CollDetectBoxMesh();};e.prototype.detectionFunctors={};e.prototype.collBody=null;e.prototype._numCollisionsChecks=0;e.prototype.addCollisionBody=function(i){if(!this.findBody(i)){this.collBody.push(i);}};e.prototype.removeCollisionBody=function(i){if(this.findBody(i)){this.collBody.splice(this.collBody.indexOf(i),1);}};e.prototype.removeAllCollisionBodies=function(){this.collBody=[];};e.prototype.detectCollisions=function(i,m){if(!i.isActive){return;}var n;var o;for(var l=0;l<this.collBody.length;l++){var k=this.collBody[l];if(i==k){continue;}if(this.checkCollidables(i,k)&&this.detectionFunctors[i.get_type()+"_"+k.get_type()]!=undefined){n=new g();n.body0=i;n.body1=k;o=this.detectionFunctors[n.body0.get_type()+"_"+n.body1.get_type()];o.collDetect(n,m);}}};e.prototype.detectAllCollisions=function(i,k){};e.prototype.collisionSkinMoved=function(i){};e.prototype.segmentIntersect=function(m,i,l){m.frac=c.NUM_HUGE;m.position=[];m.normal=[];var n=new a();for(j=0;j<this.collBody.length;j++){var k=this.collBody[j];if(k!=l&&this.segmentBounding(i,k)){if(k.segmentIntersect(n,i,k.get_currentState())){if(n.frac<m.frac){m.position=n.position;m.normal=n.normal;m.frac=n.frac;m.rigidBody=k;}}}}if(m.frac>1){return false;}if(m.frac<0){m.frac=0;}else{if(m.frac>1){m.frac=1;}}return true;};e.prototype.segmentBounding=function(i,n){var o=i.getPoint(0.5);var k=d.get_length(i.delta)/2;if(n.get_type()!="PLANE"&&n.get_type()!="TERRAIN"&&n.get_type()!="TRIANGLEMESH"){var m=d.get_length(d.subtract(o,n.get_currentState().position));var l=k+n.get_boundingSphere();if(m<=l){return true;}else{return false;}}else{return true;}};e.prototype.get_numCollisionsChecks=function(){return this._numCollisionsChecks;};e.prototype.findBody=function(i){return this.collBody.indexOf(i)>-1;};e.prototype.checkCollidables=function(k,i){if(k.get_nonCollidables().length==0&&i.get_nonCollidables().length==0){return true;}if(k.get_nonCollidables().indexOf(i)>-1){return false;}if(i.get_nonCollidables().indexOf(k)>-1){return false;}return true;};b.CollisionSystemAbstract=e;})(jigLib);